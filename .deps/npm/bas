/**
 * Minified by jsDelivr using Terser v5.39.0.
 * Original file: /npm/bas@0.1.1/lib/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var yoyaku=require("yoyaku"),parser=require("csstree"),cheerio=require("cheerio"),EventEmitter=require("events").EventEmitter,util=require("util"),fs=yoyaku.api(require("fs")),RuleList=require("./rule-list"),Ruleset=require("./rule-set"),Assertion=require("./assertion"),SelectorGroup=require("./selector-group"),processTree=require("./processor"),defTests=require("./tests"),BAS=function(e){var t=[],r=defTests,n=new RuleList,i=0,s=0,o=0;e=e||{},t.clear=function(){t.length=0},this.__defineGetter__("errors",(function(){return t})),this.__defineGetter__("tests",(function(){return r})),this.__defineGetter__("rules",(function(){return n})),this.__defineGetter__("stats",(function(){var e={};return e.__defineGetter__("testCount",(function(){return+i})),e.__defineGetter__("assertionsChecked",(function(){return+s})),e.__defineGetter__("testsRun",(function(){return+o})),e.reset=function(){return o=0,s=0,i=0,e},e})),this.continueOnParseFail=e.continueOnParseFail||!1,this._set=function(e,t){return"testCount"===e?!!(i=t):"assertionsChecked"===e?!!(s=t):"testsRun"===e?!!(o=t):void 0}};util.inherits(BAS,EventEmitter),BAS.prototype.loadSheet=yoyaku.yepnope((function(e,t){var r=this;if(e instanceof Buffer)r.parseSheet(e).yep(t.yep);else if("string"==typeof e)fs.readFile(e).yep((function(e){r.parseSheet(e).yep(t.yep)})).nope(t.nope);else if(Array.isArray(e)){var n,i=0;e.forEach((function(s){n||r.loadSheet(s).yep((function(s){++i!==e.length||n||t.yep(r)})).nope((function(){n=!0,t.nope()}))}))}else t.nope(new Error("You must supply a buffer or string filename."))})),BAS.prototype.parseSheet=yoyaku.yepnope((function(e,t){var r=this,n=parser(e.toString("utf8"));r.rules.append(processTree(n)),r.emit("loadsheet"),t.yep(r)})),BAS.prototype.registerTest=function(e,t){if(!(t instanceof Function))throw new Error("Tests must be a function.");this.tests[e]=t,this.emit("testregistered",e,t)},BAS.prototype.run=yoyaku.yepnope((function(e,t,r,n){if(!(e&&t&&n))throw new Error("BAS.run() must be called with three arguments. (url, res, data)");var i,s,o=this;try{i=cheerio.load(r)}catch(e){if(s=new Error("Failed to load document data. Parse failed with message: "+e.message),!o.continueOnParseFail)throw s;o.emit("parserror",s),i=cheerio.load("")}function u(e,t,r,n){o.emit("assertion",t,r),t.test(e,o.tests,r)?o.emit("assertionsuccess",t,r):a(t,e,r,n)}function a(e,t,r,n){var i=e.toError(t,o.tests,r,n);o.emit("assertionfailed",i,e),i.forEach((function(e){o.errors.push(e)}))}function c(e,t,r){var n=e.getNodes(t,r);o.emit("selector",e,n),!n.length&&e.isRequired()&&a(e.isRequired(),t,null,e),n.each((function(r,i){t.selectionLength=n.length,e.assertions.forEach((function(r){u(t,r,i,String(e))}))})),n.length&&e.children&&e.children.forEach((function(e){if(e instanceof SelectorGroup)return e.nodeSpecific?n.each((function(r,n){c(e,t,t.document(n))})):void c(e,t)}))}this.emit("start",e),this.errors.clear(),this.rules.forEach((function(n){var s={url:e,res:t,data:r,document:i,tests:o.tests};n.validFor(s,o.tests)&&(o.emit("startgroup",n),n.assertions.forEach((function(e){u(s,e)})),n.children&&n.children.forEach((function(e){e instanceof SelectorGroup&&c(e,s)})))})),this.emit("end",e,this.errors),n.yep(this.errors)})),module.exports=BAS;
//# sourceMappingURL=/sm/12d5ba980f917f5f4b71b8eb627b80106d8d65858caee7b155a08d1fb46588dc.map